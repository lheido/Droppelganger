var Droppelganger=function(a){if(void 0==Hammer)throw"Hammer is undefined";this.setOptions(a),this.init()};(function(){this.init=function(){this.containers=document.getElementsByClassName(this.selectors.container),this.items=document.getElementsByClassName(this.selectors.item);var a=this;Hammer.each(this.items,function(b,c,d){var e=b.getElementsByClassName(a.selectors.handle),f=new Hammer(e.length>0?e[0]:b);e.length>0&&(b.style.cursor="default"),f.get("pan").set({direction:Hammer.DIRECTION_ALL}),f.on("panstart",function(c){a.onPanStart(c,b)}),f.on("panmove",function(c){a.onPanMove(c,b)}),f.on("panend",function(c){a.onPanEnd(c,b)}),b.mc=f})},this.reset=function(){for(var a=0;a<this.items.length;a++)this.items[a].mc.destroy();this.init()},this.setOptions=function(a){var b="undefined"==typeof a?{}:a;if(this.customStyle={moving:!1,containerHovered:!1},"undefined"!=typeof b.style)for(var c in b.style)switch(c){case"moving":this.customStyle.moving=b.style[c];break;case"container-hovered":this.customStyle.containerHovered=b.style[c]}if(this.sortable=!0,"undefined"!=typeof b.sortable&&(this.sortable=b.sortable),"undefined"!=typeof b.panStartCallback&&(this.panStartCallback=b.panStartCallback),"undefined"!=typeof b.panMoveCallback&&(this.panMoveCallback=b.panMoveCallback),"undefined"!=typeof b.panEndCallback&&(this.panEndCallback=b.panEndCallback),this.selectors={container:"droppelganger-container",item:"droppelganger-item",handle:"droppelganger-item-handle"},"undefined"!=typeof b.selectors)for(var d in b.selectors)"undefined"!=typeof b.selectors[d]&&(this.selectors[d]=b.selectors[d])},this.onPanStart=function(a,b){this.phantom=b.cloneNode(!0),this.phantom.style.opacity="0.5";var c=b.parentNode.children,d=Array.prototype.indexOf.call(c,b);b.index=d,d==c.length?b.parentNode.appendChild(this.phantom):b.parentNode.insertBefore(this.phantom,c[d]);var e=document.body.getBoundingClientRect(),f=this.phantom.getBoundingClientRect(),g=f.top-e.top,h=f.left-e.left;b.orignalPostion={y:a.center.y,x:a.center.x,top:g,left:h},this.applyItemStyle(b),"undefined"!=typeof this.panStartCallback&&this.panStartCallback(a,b,b.parentNode)},this.onPanMove=function(a,b){var c=a.center.y-b.orignalPostion.y+b.orignalPostion.top,d=a.center.x-b.orignalPostion.x+b.orignalPostion.left;b.style.top=c+"px",b.style.left=d+"px";var e=this.isInContainer(b);if(this.sortable)if(e){for(var f=-1,g=0;g<e.children.length;g++){var h=e.children[g];h.isEqualNode(b)||h.isEqualNode(this.phantom)||c>h.offsetTop&&(f=g)}f>-1?e.insertBefore(this.phantom,e.children[f].nextSibling):e.insertBefore(this.phantom,e.children[0])}else b.parentNode.insertBefore(this.phantom,b.parentNode.children[b.index]);this.resetContainersStyle(),e&&!e.isEqualNode(b.parentNode)&&this.applyContainerStyle(e),"undefined"!=typeof this.panMoveCallback&&this.panMoveCallback(a,b,e?e:b.parentNode)},this.onPanEnd=function(a,b){var c=this.isInContainer(b);c?(this.sortable||c.appendChild(this.phantom),c.replaceChild(b,this.phantom)):b.parentNode.removeChild(this.phantom),this.resetItemStyle(b),this.resetContainersStyle(),"undefined"!=typeof this.panEndCallback&&this.panEndCallback(a,b,c?c:b.parentNode)},this.isInContainer=function(a){var b=a.offsetLeft,c=a.offsetTop;for(var d in this.containers){var e=this.containers[d].offsetTop,f=this.containers[d].offsetLeft,g=this.containers[d].offsetHeight,h=this.containers[d].offsetWidth;if(f+h>=b&&b>=f&&e+g>=c&&c>=e)return this.containers[d]}return!1},this.resetContainersStyle=function(){for(var a=0;a<this.containers.length;a++)this.containers[a].classList.remove("container-hovered"),this.customStyle.containerHovered&&this.containers[a].classList.remove(this.customStyle.containerHovered)},this.applyContainerStyle=function(a){a.classList.add("container-hovered"),this.customStyle.containerHovered&&a.classList.add(this.customStyle.containerHovered)},this.applyItemStyle=function(a){a.classList.add("moving"),this.customStyle.moving&&a.classList.add(this.customStyle.moving),a.style.top=a.orignalPostion.top+"px",a.style.left=a.orignalPostion.left+"px",a.style.width=window.getComputedStyle(this.phantom,"").getPropertyValue("width")},this.resetItemStyle=function(a){a.classList.remove("moving"),this.customStyle.moving&&a.classList.remove(this.customStyle.moving)}}).call(Droppelganger.prototype);